<html>

<head>
    <script>
        //require('isomorphic-fetch');
        function formatDate(f) {
            var d = Date.parse(f);
            if (!isNaN(d)) {
                return new Date(d).toISOString().substring(0, 10)
            }
            throw new Error('not a date')
        }
        fetch('https://data.coderbunker.com/graphql', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                query: `
                {
                    allOrganizations {
                    edges {
                      node {
                        orgname
                        since
                        activity
                        peopleCount
                        projectCount
                        totalGross
                        lastRefresh
                        lastUpdate
                        totalEngMonths
                      }
                    }
                  }
                }
                ` }),
        })
            .then(res => {
                return res.json().then(o => {
                    console.log(o);
                    Object.keys(o.data.allOrganizations.edges[0].node).map(k => {
                        var holder;
                        try {
                            holder = document.getElementById(k)
                            holder.innerText = o.data.allOrganizations.edges[0].node[k]
                        } catch (e) {
                            console.log('ignoring ' + k)
                            return;
                        }
                    });
                    const e = document.getElementById('totalGross')
                    e.innerText = 'RMB' + e.innerText.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
                    ['lastUpdate', 'since'].map(i => {
                        const e2 = document.getElementById(i)
                        e2.innerText = formatDate(e2.innerText);
                    })
                });
            })
            .then(res => console.log(res.data))
            .catch(e => console.log(e));
    </script>
    <style>
        div {
            width: 800px;
        }

        h2 {
            font: 400 40px/1.5 Helvetica, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        li {
            font: 200 20px/1.5 Helvetica, Verdana, sans-serif;
            border-bottom: 1px solid #ccc;
        }

        li:last-child {
            border: none;
        }

        li span {
            text-decoration: none;
            color: #000;
            display: block;
            width: 800px;
            font: 400 40px/1.5 Helvetica, Verdana, sans-serif;

            -webkit-transition: font-size 0.3s ease, background-color 0.3s ease;
            -moz-transition: font-size 0.3s ease, background-color 0.3s ease;
            -o-transition: font-size 0.3s ease, background-color 0.3s ease;
            -ms-transition: font-size 0.3s ease, background-color 0.3s ease;
            transition: font-size 0.3s ease, background-color 0.3s ease;
        }

        li span:hover {
            font-size: 72px;
            background: #f6f6f6;
        }
    </style>
</head>

<body>
    <div>
        <h2>
            <div id="orgname"></div>
        </h2>
        <ul>
            <li>People count
                <span id="peopleCount"></span>
            </li>
            <li> Project count
                <span id="projectCount"></span>
            </li>
            <li> First billable hour recorded
                <span id="since"></span>
            </li>
            <li>Time since first billable hour
                <span id="activity"></span>
            </li>
            <li> Total Gross Billed (RMB)
                <span id="totalGross"></span>
            </li>
            <li> Total Engineering months
                <span id="totalEngMonths"></span>
            </li>
            <li> Data last updated
                <span id="lastUpdate"></span>
            </li>
        </ul>
    </div>
</body>

</html>